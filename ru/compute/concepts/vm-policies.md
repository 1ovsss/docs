# Политики обслуживания виртуальных машин

*Политики обслуживания* виртуальных машин (Compute Maintenance Policies) дают возможность сообщить о плановом воздействии на ВМ пользователя со стороны инфраструктуры облака с помощью [сервиса метаданных](https://cloud.yandex.ru/ru/docs/compute/concepts/vm-metadata).

Под плановым воздействием понимается наступления одного из следующих событий обслуживания для ВМ:

* `TERMINATE_ON_HOST_MAINTENANCE` — запланирована остановка ВМ пользователя.
* `MIGRATE_ON_HOST_MAINTENANCE` — запланирована [динамическая миграция](https://cloud.yandex.ru/ru/docs/compute/concepts/live-migration) ВМ пользователя на другой хост (сервер).

Политику обслуживания ВМ можно определить c помощью:

* Типа политики обслуживания — `maintenance_policy`.
* Времени начала ее исполнения — `maintenance_grace_period`.

Поддерживаются следующие типы политики обслуживания:

* `RESTART` — при наступлении события обслуживания в метаданных появляется строчка `TERMINATE_ON_HOST_MAINTENANCE`. По прошествии `maintenance_grace_period` ВМ будет перемещена на другой хост через процедуры остановки ВМ и ее запуска.
* `MIGRATE` — при наступлении события обслуживания в метаданных ВМ появляется строка `MIGRATE_ON_HOST_MAINTENANCE`. По прошествии `maintenance_grace_period` ВМ будет перемещена на другой хост с помощью процедуры живой миграции.
* `MAINTENANCE_POLICY_UNSPECIFIED` — политика обслуживания по умолчанию, если политика обслуживания не задана явно. При этом в сервис метаданных ВМ ничего не выставляется.

При задании времени начала обслуживания следует помнить, что начало выполнения можно максимально задержать на следующий интервал времени от момента наступления события обслуживания:

* `до 1 минуты` для живой миграции или выключения ВМ без GPU.
* `до 24 часов` для ВМ с GPU.

#### Поддержка политик обслуживания для прерываемых ВМ {#int}

[Прерываемые ВМ](../concepts/preemptible-vm.md) при наступлении событий обслуживания не мигрируют, а просто останавливаются. При этом никаких событий обслуживания в метаданных ВМ не появляется.

Разработка данной функциональности для прерываемых ВМ пока не реализована, но планируется в будущем. Для прерываемых ВМ с GPU максимальный `grace period` не может быть более 1 минуты.

### Включить политику обслуживания ВМ {#apply}

[Включить и настроить](../operations/vm-control/vm-update-policies.md) политики обслуживания ВМ можно с помощью [CLI](../../cli/index.yaml) и [Terraform](../../tutorials/infrastructure-management/terraform-quickstart.md). В консоли управления политики обслуживания сейчас настраивать нельзя.
